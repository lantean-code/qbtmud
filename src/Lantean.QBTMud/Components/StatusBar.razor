@using Lantean.QBTMud.Helpers

<MudAppBar Bottom="true" Dense="true" Class="app-shell__status-bar">
    <MudSpacer />
    @{
        var freeSpaceValue = DisplayHelpers.Size(MainData?.ServerState.FreeSpaceOnDisk);
        var freeSpaceText = ShowStatusLabels
            ? WebUiLocalizer.Translate("HttpServer", "Free space: %1", freeSpaceValue)
            : freeSpaceValue;
    }
    <MudText Class="mx-2 d-none d-sm-flex"
             data-test-id="@TestIdHelper.For("Status-FreeSpace")">@freeSpaceText</MudText>
    @{
        var externalIpLabel = Preferences?.StatusBarExternalIp == true
            ? (ShowStatusLabels ? BuildExternalIpLabel(MainData?.ServerState) : BuildExternalIpValue(MainData?.ServerState))
            : null;
    }
    @if (!string.IsNullOrEmpty(externalIpLabel))
    {
        <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" Class="d-none d-sm-flex" />
        <MudText Class="mx-2 d-none d-sm-flex"
                 data-test-id="@TestIdHelper.For("Status-ExternalIp")">@externalIpLabel</MudText>
    }
    <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" Class="d-none d-sm-flex" />
    @{
        var dhtNodesValue = MainData?.ServerState.DHTNodes ?? 0;
        var dhtNodesText = ShowStatusLabels
            ? WebUiLocalizer.Translate("StatusBar", "DHT: %1 nodes", dhtNodesValue)
            : dhtNodesValue.ToString();
    }
    <MudText Class="mx-2 d-none d-sm-flex"
             data-test-id="@TestIdHelper.For("Status-DhtNodes")">@dhtNodesText</MudText>
    <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" Class="d-none d-sm-flex" />
    @{
        var (icon, colour) = GetConnectionIcon(MainData?.ServerState.ConnectionStatus);
        var connectionTitle = BuildConnectionStatusTitle(MainData?.ServerState.ConnectionStatus);
    }
    <MudTooltip Text="@connectionTitle" data-test-id="@TestIdHelper.For("Status-ConnectionTooltip")">
        <MudIcon Class="mx-1" Icon="@icon" Color="@colour" data-test-id="@TestIdHelper.For("Status-ConnectionIcon")" />
    </MudTooltip>
    <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" />
    <MudTooltip Text="@BuildTimerTooltip()" data-test-id="@TestIdHelper.For("Status-TimerTooltip")">
        <MudIconButton Class="mx-1"
                       Icon="@GetTimerStatusIcon()"
                       Color="@GetTimerStatusColor()"
                       OnClick="ToggleTimerDrawerClicked"
                       data-test-id="@TestIdHelper.For("Status-TimerButton")" />
    </MudTooltip>
    <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" />
    <MudTooltip Text="@BuildAlternativeSpeedLimitsTooltip()" data-test-id="@TestIdHelper.For("Status-AltSpeedTooltip")">
        <MudIconButton Class="@($"mx-1{((MainData?.ServerState.UseAltSpeedLimits ?? false) ? " app-shell__alt-speed-enabled" : string.Empty)}")"
                       Icon="@Icons.Material.Outlined.Speed"
                       Color="@((MainData?.ServerState.UseAltSpeedLimits ?? false) ? Color.Error : Color.Success)"
                       OnClick="ToggleAlternativeSpeedLimitsClicked"
                       Disabled="ToggleAlternativeSpeedLimitsInProgress"
                       data-test-id="@TestIdHelper.For("Status-AltSpeedButton")" />
    </MudTooltip>
    <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" />
    <MudIcon Class="ml-1" Icon="@Icons.Material.Filled.KeyboardDoubleArrowDown" Color="Color.Success" />
    <MudText Class="mr-1" data-test-id="@TestIdHelper.For("Status-Download")">@BuildTransferInfo(MainData?.ServerState.DownloadInfoSpeed, MainData?.ServerState.DownloadRateLimit, MainData?.ServerState.DownloadInfoData)</MudText>
    <MudDivider Vertical="true" Light="@UseLightStatusBarDividers" />
    <MudIcon Class="ml-1" Icon="@Icons.Material.Filled.KeyboardDoubleArrowUp" Color="Color.Info" />
    <MudText Class="mr-1" data-test-id="@TestIdHelper.For("Status-Upload")">@BuildTransferInfo(MainData?.ServerState.UploadInfoSpeed, MainData?.ServerState.UploadRateLimit, MainData?.ServerState.UploadInfoData)</MudText>
</MudAppBar>
