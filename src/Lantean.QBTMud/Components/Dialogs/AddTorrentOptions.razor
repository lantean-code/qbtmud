@using Lantean.QBitTorrentClient.Models
@using Lantean.QBTMud.Components.UI
@inject Lantean.QBTMud.Services.Localization.ILanguageLocalizer LanguageLocalizer

<MudGrid>
    <MudItem xs="12">
        <MudSwitch Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Torrent options")" @bind-Value="Expanded" LabelPlacement="Placement.End" data-test-id="@TestIdHelper.For("AdditionalOptions")" />
    </MudItem>
</MudGrid>
<MudCollapse Expanded="Expanded">
    <MudGrid Class="mt-2">
        <MudItem xs="12">
            <MudSelect T="bool" Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Torrent Management Mode:")" Value="@TorrentManagementMode" ValueChanged="@SetTorrentManagementMode" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("TorrentManagementMode")">
                <MudSelectItem Value="@false">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Manual")</MudSelectItem>
                <MudSelectItem Value="@true">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Automatic")</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="6">
            <PathAutocomplete Label="@LanguageLocalizer.Translate("HttpServer", "Save files to location:")"
                              Value="@SavePath"
                              ValueChanged="@(value => SavePathChanged(value ?? string.Empty))"
                              Mode="DirectoryContentMode.Directories"
                              Disabled="@TorrentManagementMode"
                              data-test-id="@TestIdHelper.For("SaveFilesLocation")" />
        </MudItem>
        <MudItem xs="12" sm="6">
            <FieldSwitch Label="@LanguageLocalizer.Translate("OptionsDialog", "Keep incomplete torrents in:")" Value="@UseDownloadPath" ValueChanged="@SetUseDownloadPath" Disabled="@TorrentManagementMode" data-test-id="@TestIdHelper.For("UseIncompleteSavePath")" />
        </MudItem>
        <MudItem xs="12">
            <PathAutocomplete Label="@LanguageLocalizer.Translate("TransferListModel", "Incomplete Save Path")"
                              Value="@DownloadPath"
                              ValueChanged="@(value => DownloadPathChanged(value ?? string.Empty))"
                              Mode="DirectoryContentMode.Directories"
                              Disabled="@DownloadPathDisabled"
                              data-test-id="@TestIdHelper.For("IncompleteSavePath")" />
        </MudItem>
        @if (ShowCookieOption)
        {
            <MudItem xs="12">
                <MudTextField Label="@LanguageLocalizer.Translate("CookiesDialog", "Cookie")" @bind-Value="Cookie" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("Cookie")" />
            </MudItem>
        }
        <MudItem xs="12">
            <MudTextField Label="@LanguageLocalizer.Translate("HttpServer", "Rename torrent")" @bind-Value="RenameTorrent" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("Rename")" />
        </MudItem>
        <MudItem xs="12">
            <MudSelect T="string" Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Category:")" Value="@Category" ValueChanged="@CategoryChanged" Variant="Variant.Outlined" ShrinkLabel="true" Clearable="true" data-test-id="@TestIdHelper.For("Category")">
                <MudSelectItem Value="@string.Empty">@LanguageLocalizer.Translate("AddNewTorrentDialog", "None")</MudSelectItem>
                @foreach (var category in CategoryOptions)
                {
                    <MudSelectItem Value="@category.Name">@category.Name</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <MudSelect T="string" Label="@LanguageLocalizer.Translate("TransferListWidget", "Tags")" Variant="Variant.Outlined" ShrinkLabel="true" MultiSelection="true" SelectedValues="@SelectedTags" SelectedValuesChanged="@SelectedTagsChanged" Disabled="@(AvailableTags.Count == 0)" data-test-id="@TestIdHelper.For("Tags")">
                @foreach (var tag in AvailableTags)
                {
                    <MudSelectItem Value="@tag">@tag</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <FieldSwitch Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Start torrent")" @bind-Value="StartTorrent" data-test-id="@TestIdHelper.For("StartTorrent")" />
        </MudItem>
        <MudItem xs="12">
            <FieldSwitch Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Add to top of queue")" @bind-Value="AddToTopOfQueue" data-test-id="@TestIdHelper.For("AddToTopOfQueue")" />
        </MudItem>
        <MudItem xs="12">
            <MudSelect T="string" Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Stop condition:")" Value="@StopCondition" ValueChanged="@StopConditionChanged" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("StopCondition")">
                <MudSelectItem Value="@("None")">@LanguageLocalizer.Translate("AddNewTorrentDialog", "None")</MudSelectItem>
                <MudSelectItem Value="@("MetadataReceived")">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Metadata received")</MudSelectItem>
                <MudSelectItem Value="@("FilesChecked")">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Files checked")</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <FieldSwitch Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Skip hash check")" @bind-Value="SkipHashCheck" data-test-id="@TestIdHelper.For("SkipHashCheck")" />
        </MudItem>
        <MudItem xs="12">
            <MudSelect T="string" Label="@LanguageLocalizer.Translate("AddNewTorrentDialog", "Content layout:")" Value="@ContentLayout" ValueChanged="@ContentLayoutChanged" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("ContentLayout")">
                <MudSelectItem Value="@("Original")">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Original")</MudSelectItem>
                <MudSelectItem Value="@("Subfolder")">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Create subfolder")</MudSelectItem>
                <MudSelectItem Value="@("NoSubfolder")">@LanguageLocalizer.Translate("AddNewTorrentDialog", "Don't create subfolder")</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <FieldSwitch Label="@LanguageLocalizer.Translate("TransferListWidget", "Download in sequential order")" @bind-Value="DownloadInSequentialOrder" data-test-id="@TestIdHelper.For("DownloadSequentially")" />
        </MudItem>
        <MudItem xs="12">
            <FieldSwitch Label="@LanguageLocalizer.Translate("TransferListWidget", "Download first and last pieces first")" @bind-Value="DownloadFirstAndLastPiecesFirst" data-test-id="@TestIdHelper.For("DownloadFirstLastPieces")" />
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudNumericField Label="@LanguageLocalizer.Translate("HttpServer", "Limit download rate")" @bind-Value="DownloadLimit" Variant="Variant.Outlined" ShrinkLabel="true" Min="0" data-test-id="@TestIdHelper.For("DownloadLimit")" />
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudNumericField Label="@LanguageLocalizer.Translate("HttpServer", "Limit upload rate")" @bind-Value="UploadLimit" Variant="Variant.Outlined" ShrinkLabel="true" Min="0" data-test-id="@TestIdHelper.For("UploadLimit")" />
        </MudItem>
        <MudItem xs="12">
            <MudSelect T="ShareLimitMode" Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "Torrent Upload/Download Ratio Limiting")" Value="@SelectedShareLimitMode" ValueChanged="@ShareLimitModeChanged" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("ShareLimitMode")">
                <MudSelectItem Value="@ShareLimitMode.Global">@LanguageLocalizer.Translate("UpDownRatioDialog", "Use global share limit")</MudSelectItem>
                <MudSelectItem Value="@ShareLimitMode.NoLimit">@LanguageLocalizer.Translate("UpDownRatioDialog", "Set no share limit")</MudSelectItem>
                <MudSelectItem Value="@ShareLimitMode.Custom">@LanguageLocalizer.Translate("UpDownRatioDialog", "Set share limit to")</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="4">
            <FieldSwitch Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "ratio")" Value="@RatioLimitEnabled" ValueChanged="@RatioLimitEnabledChanged" Disabled="@(!IsCustomShareLimit)" data-test-id="@TestIdHelper.For("RatioLimitEnabled")" />
        </MudItem>
        <MudItem xs="12" sm="8">
            <MudNumericField T="float" Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "ratio")" Value="@RatioLimit" ValueChanged="@RatioLimitChanged" Disabled="@(!RatioLimitEnabled || !IsCustomShareLimit)" Min="0" Step="0.1f" Format="F2" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("RatioLimit")" />
        </MudItem>
        <MudItem xs="12" sm="4">
            <FieldSwitch Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "total minutes")" Value="@SeedingTimeLimitEnabled" ValueChanged="@SeedingTimeLimitEnabledChanged" Disabled="@(!IsCustomShareLimit)" data-test-id="@TestIdHelper.For("SeedingTimeLimitEnabled")" />
        </MudItem>
        <MudItem xs="12" sm="8">
            <MudNumericField T="int" Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "total minutes")" Value="@SeedingTimeLimit" ValueChanged="@SeedingTimeLimitChanged" Disabled="@(!SeedingTimeLimitEnabled || !IsCustomShareLimit)" Min="1" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("SeedingTimeLimit")" />
        </MudItem>
        <MudItem xs="12" sm="4">
            <FieldSwitch Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "inactive minutes")" Value="@InactiveSeedingTimeLimitEnabled" ValueChanged="@InactiveSeedingTimeLimitEnabledChanged" Disabled="@(!IsCustomShareLimit)" data-test-id="@TestIdHelper.For("InactiveSeedingTimeLimitEnabled")" />
        </MudItem>
        <MudItem xs="12" sm="8">
            <MudNumericField T="int" Label="@LanguageLocalizer.Translate("UpDownRatioDialog", "inactive minutes")" Value="@InactiveSeedingTimeLimit" ValueChanged="@InactiveSeedingTimeLimitChanged" Disabled="@(!InactiveSeedingTimeLimitEnabled || !IsCustomShareLimit)" Min="1" Variant="Variant.Outlined" ShrinkLabel="true" data-test-id="@TestIdHelper.For("InactiveSeedingTimeLimit")" />
        </MudItem>
    </MudGrid>
</MudCollapse>
