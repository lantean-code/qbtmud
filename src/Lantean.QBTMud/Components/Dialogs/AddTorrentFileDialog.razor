@inherits SubmittableDialog
@using Lantean.QBTMud.Helpers
@inject Lantean.QBTMud.Services.Localization.IWebUiLocalizer WebUiLocalizer

<MudDialog>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12">
                <MudFileUpload T="IReadOnlyList<IBrowserFile>" FilesChanged="UploadFiles" Accept=".torrent" MaximumFileCount="50" data-test-id="@TestIdHelper.For("AddTorrentFileUpload")">
                    <ActivatorContent>
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Default"
                                   StartIcon="@Icons.Material.Filled.CloudUpload"
                                   data-test-id="@TestIdHelper.For("AddTorrentFileChoose")">
                            @WebUiLocalizer.Translate("AddNewTorrentDialog", "Select .torrent files")
                        </MudButton>
                    </ActivatorContent>
                </MudFileUpload>
            </MudItem>
            <MudItem xs="12">
                @if (Files.Any())
                {
                    <MudCard Elevation="3" Class="mb-3" data-test-id="@TestIdHelper.For("AddTorrentFileList")">
                        <MudCardHeader Class="pb-0">
                            @($"{WebUiLocalizer.Translate("AddNewTorrentDialog", "Select .torrent files")} ({Files.Count})")
                        </MudCardHeader>
                        <MudCardContent>
                            <MudList T="string">
                                @foreach (var file in Files)
                                {
                                    <MudListItem>
                                        <div class="w-100 d-flex align-center">
                                            <span>@file.Name</span>
                                            <MudSpacer />
                                            <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                                           Color="Color.Error"
                                                           Variant="Variant.Text"
                                                           Size="Size.Small"
                                                           OnClick="@(() => Remove(file))"
                                                           data-test-id="@TestIdHelper.For($"RemoveTorrentFile-{file.Name}")" />
                                        </div>
                                    </MudListItem>
                                }
                            </MudList>
                        </MudCardContent>
                    </MudCard>
                }
            </MudItem>
        </MudGrid>
        <AddTorrentOptions @ref="TorrentOptions" ShowCookieOption="true" />
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" Color="Color.Default" OnClick="Cancel" data-test-id="@TestIdHelper.For("AddTorrentFileClose")">@WebUiLocalizer.Translate("PluginSelectDlg", "Close")</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="Submit" data-test-id="@TestIdHelper.For("AddTorrentFileSubmit")">@WebUiLocalizer.Translate("HttpServer", "Upload Torrents")</MudButton>
    </DialogActions>
</MudDialog>
